# Price Parser Service

## Описание проекта

Spring Boot REST-приложение для многопоточного парсинга товаров с сайта poryadok.ru, сохранения и обновления данных в базе H2.  
Сервис автоматически собирает информацию о товарах и предоставляет REST API для просмотра и запуска парсинга.

---

## Архитектура и основные классы

### PriceParserApplication
Точка входа приложения.
- Запускает Spring Boot
- Инициализирует первичный парсинг данных при старте приложения

---

### ProductEntity
JPA-сущность товара.
Содержит:
- `article` — артикул товара (бизнес-ключ)
- `name` — название
- `description` — описание
- `price` — цена
- `parsedAt` — дата и время последнего парсинга

Используется для хранения данных в БД.

---

### ProductRepository
JPA-репозиторий (`JpaRepository<ProductEntity, Long>`).
Обеспечивает:
- CRUD-операции
- поиск товара по артикулу

---

### ProductParser
Утилитарный класс для HTML-парсинга.
Отвечает за:
- формирование URL поисковых страниц
- загрузку HTML через Jsoup
- извлечение данных о товарах
- преобразование результатов в `ProductEntity`

Не зависит от Spring и не работает напрямую с БД.

---

### ProductParserService
Сервисный слой с основной бизнес-логикой:
- многопоточный парсинг товаров
- сохранение и обновление записей в БД
- защита от дубликатов по артикулу
- проверка актуальности данных
- инициализация и обновление базы данных
- получение данных для REST-контроллера

---

### ProductController
REST-контроллер, предоставляющий API:
- получение всех товаров
- получение товара по id
- получение товара по артикулу
- запуск парсинга через POST-запрос

---

## Многопоточность

Для ускорения парсинга используется `ExecutorService` с фиксированным пулом потоков:
- формируется список поисковых запросов
- страницы выдачи обрабатываются параллельно
- если страница не содержит товаров, дальнейший парсинг для неё прекращается
- результаты безопасно сохраняются в БД

---

## Планировщик задач

В проекте используется `@Scheduled`-планировщик. Задачи :
- периодически запускать обновление данных в БД (для теста настроено каждые 2 минуты)
- перед парсингом проверять актуальность данных по полю `parsedAt`
- если данные актуальны, парсинг не выполняется

---

## Тестирование и проверка работы

### Запуск приложения

Запуск стандартным способом:
```bash
mvn spring-boot:run
```

При старте приложения автоматически выполняется первичный парсинг данных.

---

### Swagger UI

Swagger доступен по адресу:
```
http://localhost:8080/swagger-ui.html
```

---

### REST-эндпоинты

#### Получить все товары
```
GET /answer
```

#### Получить товар по ID
```
GET /answer/{id}
```
Пример:
```
/answer/1
```

#### Получить товар по артикулу
```
GET /answer/article?article=123456
```

#### Запустить парсинг товаров
```
POST /parse
```

Параметры:
- `query` — строка для поиска товара

Пример:
```
POST /parse?query=горшок
```
В ответ возвращается количество добавленных записей.

---
